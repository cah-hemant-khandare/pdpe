UPDATE
  `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST` a
SET
  NET_CONTRACT_PRICE_CHPDPE_CEITMPX = b.NET_CONTRACT_PRICE,
  base_price_worke_CHPDPE_CEITMPX = b.base_price_worke,
  CMPR_ZVB0_CHPDPE_CEITMPX = b.CMPR_ZVB0,
  AWP_ZREF_CHPDPE_CEITMPX = b.AWP_ZREF,
  MSRP_ZMSR_CHPDPE_CEITMPX = b.MSRP_ZMSR,
  CATLG_PRICED_AT_KUNNR_CHPDPE_CEITMPX = b.CATLG_PRICED_AT_KUNNR,
  RTL_PRICED_AT_KUNNR_CHPDPE_CEITMPX = b.RTL_PRICED_AT_KUNNR,
  SOURCE_DIVISION_CHPDPE_CEITMPX = b.SOURCE_DIVISION,
  PRICE_DIVISION_CHPDPE_CEITMPX = b.PRICE_DIVISION,
  PRIMARY_BU_CHPDPE_CEITMPX = b.PRIMARY_BU,
  WERKS_CHPDPE_CEITMPX = b.WERKS,
  WIN_CONTRACT_CHPDPE_CEITMPX = b.WIN_CONTRACT,
  HIERCY_CHPDPE_CEITMPX = b.HIERCY,
  PREFR_CHPDPE_CEITMPX = b.PREFR,
  PCTYP_CHPDPE_CEITMPX = b.PCTYP,
  CN_SEG_GROUP_CHPDPE_CEITMPX = b.CN_SEG_GROUP,
  NON_CN_SEG_GROUP_CHPDPE_CEITMPX = b.NON_CN_SEG_GROUP,
  SELL_PRICE_STRAT_CHPDPE_CEITMPX = b.SELL_PRICE_STRAT,
  COGS_STRAT_CHPDPE_CEITMPX = b.COGS_STRAT,
  EXCISE_TAX_ZTF0_CHPDPE_CEITMPX = b.EXCISE_TAX_ZTF0,
  WAC_KZWI1_CHPDPE_CEITMPX = b.WAC_KZWI1,
  PSTYV_CHPDPE_CEITMPX = b.PSTYV,
  WRPST_CHPDPE_CEITMPX = b.WRPST,
  WRPRPS_CHPDPE_CEITMPX = b.WRPRPS,
  WRPCALCTYP_CHPDPE_CEITMPX = b.WRPCALCTYP,
  KBETR_CHPDPE_CEITMPX = b.KBETR,
  INSTANT_RBT_ZVF0_CHPDPE_CEITMPX = b.INSTANT_RBT_ZVF0,
  CONSIGNMENT_MKUP_ZDP6_CHPDPE_CEITMPX = b.CONSIGNMENT_MKUP_ZDP6,
  REBATE_ELIGIBLE_FLG_CHPDPE_CEITMPX = b.REBATE_ELIGIBLE_FLG,
  OE_REP_FLAG_CHPDPE_CEITMPX = b.OE_REP_FLAG,
  EXT_PLANT_CHPDPE_CEITMPX = b.EXT_PLANT,
  ROW_UPDATE_TIMESTAMP=current_datetime() --HK :added
FROM (
  SELECT
    --HK:select the rows if there is no changes in any of the core price and change in the any of the base price cols
    `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.`CLIENT` AS join_key1,
    `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.`KUNNR` AS join_key2,
    `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.`VKORG` AS join_key3,
    `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.`VTWEG` AS join_key4,
    `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.`SPART` AS join_key5,
    `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.`MATNR` AS join_key6,
    `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.*
  FROM
    `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`
  JOIN
    `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`
  ON
    ( `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.CLIENT = `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.CLIENT_CHPDPE_CEITMPX
      AND `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.KUNNR = `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.KUNNR_CHPDPE_CEITMPX
      AND `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.VKORG = `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.VKORG_CHPDPE_CEITMPX
      AND `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.VTWEG = `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.VTWEG_CHPDPE_CEITMPX
      AND `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.SPART = `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.SPART_CHPDPE_CEITMPX
      AND `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.MATNR = `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.MATNR_CHPDPE_CEITMPX )
  WHERE
    --Total 35 cols are campared ,excluded NULLs ,keys,5 price keys cols,calculations for timestamp
    `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`._PARTITIONTIME >= v_part_date --HK:added for partition
    AND v_attr_ingst_timestamp_src >= v_attr_ingst_timestamp_trgt --DK: added for incremental load
    AND `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.CALC_CURRENT_FLAG = 'Y'
    AND ( `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.net_contract_price <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.net_contract_price_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.base_price_worke <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.base_price_worke_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.CMPR_ZVB0 <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.CMPR_ZVB0_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.AWP_ZREF <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.AWP_ZREF_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.MSRP_ZMSR <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.MSRP_ZMSR_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.CATLG_PRICED_AT_KUNNR <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.CATLG_PRICED_AT_KUNNR_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.RTL_PRICED_AT_KUNNR <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.RTL_PRICED_AT_KUNNR_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.SOURCE_DIVISION <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.SOURCE_DIVISION_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.PRICE_DIVISION <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.PRICE_DIVISION_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.PRIMARY_BU <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.PRIMARY_BU_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.WERKS <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.WERKS_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.WIN_CONTRACT <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.WIN_CONTRACT_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.HIERCY <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.HIERCY_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.PREFR <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.PREFR_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.PCTYP <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.PCTYP_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.CN_SEG_GROUP <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.CN_SEG_GROUP_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.NON_CN_SEG_GROUP <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.NON_CN_SEG_GROUP_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.SELL_PRICE_STRAT <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.SELL_PRICE_STRAT_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.COGS_STRAT <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.COGS_STRAT_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.EXCISE_TAX_ZTF0 <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.EXCISE_TAX_ZTF0_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.WAC_KZWI1 <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.WAC_KZWI1_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.PSTYV <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.PSTYV_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.WRPST <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.WRPST_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.WRPRPS <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.WRPRPS_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.WRPCALCTYP <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.WRPCALCTYP_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.KBETR <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.KBETR_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.INSTANT_RBT_ZVF0 <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.INSTANT_RBT_ZVF0_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.CONSIGNMENT_MKUP_ZDP6 <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.CONSIGNMENT_MKUP_ZDP6_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.REBATE_ELIGIBLE_FLG <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.REBATE_ELIGIBLE_FLG_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.OE_REP_FLAG <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.OE_REP_FLAG_CHPDPE_CEITMPX
      OR `datamarket-np-cah.SI_SOH_SAP.CHPDPE_CEITMPX_P`.EXT_PLANT <> `datamarket-np-cah.SMNTC_PRICING_ANALYTICS_FACT.FACT_ITEM_PRICE_LIST`.EXT_PLANT_CHPDPE_CEITMPX ) ) b
WHERE
  a.CALC_CURRENT_FLAG = 'Y'
  AND a.CLIENT_CHPDPE_CEITMPX = b.CLIENT
  AND a.KUNNR_CHPDPE_CEITMPX = b.KUNNR
  AND a.VKORG_CHPDPE_CEITMPX = b.VKORG
  AND a.VTWEG_CHPDPE_CEITMPX = b.VTWEG
  AND a.SPART_CHPDPE_CEITMPX = b.SPART
  AND a.MATNR_CHPDPE_CEITMPX = b.MATNR;